<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<th:block th:fragment="project-form">

    <div id="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a  href="/poba/home">หน้าหลัก</a></li>
            <li class="breadcrumb-item"><a  href="javascript:void(0)" onclick="loadView('/poba/project')">ข้อมูลผู้เข้าร่วมกิจกรรม</a></li>
            <li class="breadcrumb-item active" ><span id="viewName" th:text="${viewName}"></span></li>
        </ol>
    </div>

    <div class="container px-3">
        <th:block th:replace="~{fragments/input-errors}"/>
        <th:block th:replace="~{fragments/alert}"/>

        <form id="form-project" class="form-wrapper">
            <input type="hidden" id="projectId" name="projectId" th:value="${project.projectId}"/>
            <div  class="row mb-2">
                <label class="col-sm-2 form-control-label" for="projectYear">ปีการศึกษา<span style="color:red !important;">*</span>:</label>
                <select type="text" class="col-sm-4 form-control bg-white" id="projectYear" name="projectYear" required>
                    <option value="">กรุณาเลือก</option>
                    <option value="2565" th:selected="${project.projectYear == '2565'}? 'selected'">2565</option>
                    <option value="2564" th:selected="${project.projectYear == '2564'}? 'selected'">2564</option>
                    <option value="2563" th:selected="${project.projectYear == '2563'}? 'selected'">2563</option>
                </select>

                <label class="col-sm-2 form-control-label" for="projectName">ชื่อโครงการ/กิจกรรม<span style="color:red !important;">*</span>:</label>
                <input type="text" class="form-control bg-white col-sm-4" id="projectName" name="projectName"
                       th:attr="value=${project.projectName != null}? ${project.projectName}: ''" maxlength="255" required/>
            </div>

            <div  class="row mb-2">
                <label class="col-sm-2 form-control-label" for="projectInstitution">หน่วยงานที่รับผิดชอบ<span style="color:red !important;">*</span>:</label>
                <input type="text" class="form-control bg-white col-sm-4" id="projectInstitution" name="projectInstitution"
                       th:attr="value=${project.projectInstitution != null}? ${project.projectInstitution}: ''" maxlength="255" required/>
                <label class="col-sm-2 form-control-label" for="projectType">ประเภทกิจกรรม<span style="color:red !important;">*</span>:</label>
                <select type="text" class="col-sm-4 form-control bg-white" id="projectType" name="projectType" required>
                    <option value="">กรุณาเลือก</option>
                    <option value="กีฬาหรือส่งเสริมสุขภาพ" th:selected="${project.projectType == 'กีฬาหรือส่งเสริมสุขภาพ'}? 'selected'">กีฬาหรือส่งเสริมสุขภาพ</option>
                    <option value="เตรียมความรู้สู่วิชาสังคมศาสตร์" th:selected="${project.projectType == 'เตรียมความรู้สู่วิชาสังคมศาสตร์'}? 'selected'">เตรียมความรู้สู่วิชาสังคมศาสตร์</option>
                    <option value="ทักษะการวิเคราะห์เชิงตัวเลข การสื่อสารและการใช้เทคโนโลยีสารสนเทศ" th:selected="${project.projectType == 'ทักษะการวิเคราะห์เชิงตัวเลข การสื่อสารและการใช้เทคโนโลยีสารสนเทศ'}? 'selected'">ทักษะการวิเคราะห์เชิงตัวเลข การสื่อสารและการใช้เทคโนโลยีสารสนเทศ</option>
                    <option value="ทักษะความสัมพันธ์ระหว่างบุคคลและความรับผิดชอบ" th:selected="${project.projectType == 'ทักษะความสัมพันธ์ระหว่างบุคคลและความรับผิดชอบ'}? 'selected'">ทักษะความสัมพันธ์ระหว่างบุคคลและความรับผิดชอบ</option>
                    <option value="นันทนาการ" th:selected="${project.projectType == 'นันทนาการ'}? 'selected'">นันทนาการ</option>
                    <option value="บำเพ็ญประโยชน์หรือรักษาสิ่งแวดล้อม" th:selected="${project.projectType == 'บำเพ็ญประโยชน์หรือรักษาสิ่งแวดล้อม'}? 'selected'">บำเพ็ญประโยชน์หรือรักษาสิ่งแวดล้อม</option>
                    <option value="วิชาการที่ส่งเสริมคุณลักษณะบัณฑิตที่พึงปะสงค์" th:selected="${project.projectType == 'วิชาการที่ส่งเสริมคุณลักษณะบัณฑิตที่พึงปะสงค์'}? 'selected'">วิชาการที่ส่งเสริมคุณลักษณะบัณฑิตที่พึงปะสงค์</option>
                    <option value="ส่งเสริมศิลปะและวัฒนธรรม" th:selected="${project.projectType == 'ส่งเสริมศิลปะและวัฒนธรรม'}? 'selected'">ส่งเสริมศิลปะและวัฒนธรรม</option>
                    <option value="ส่งเสริมคุณธรรมและจริยธรรม" th:selected="${project.projectType == 'ส่งเสริมคุณธรรมและจริยธรรม'}? 'selected'">ส่งเสริมคุณธรรมและจริยธรรม</option>
                    <option value="สติปัญญาวิชาการที่ส่งเสริมคุณลักษณะบัณฑิตที่พึงประสงค์" th:selected="${project.projectType == 'สติปัญญาวิชาการที่ส่งเสริมคุณลักษณะบัณฑิตที่พึงประสงค์'}? 'selected'">สติปัญญาวิชาการที่ส่งเสริมคุณลักษณะบัณฑิตที่พึงประสงค์</option>
                </select>
            </div>

            <div  class="row mb-2">
                <label class="col-sm-2 form-control-label" for="projectBudget">งบประมาณ (ตั้งงบ)<span style="color:red !important;">*</span>:</label>
                <input type="text" class="form-control bg-white col-sm-4 amount" id="projectBudget" name="projectBudget"
                       th:attr="value=${project.projectBudget != null}? ${project.projectBudget}: ''" onblur="amtFormat()" required/>
                <label class="col-sm-2 form-control-label" for="projectBudgetApprove">งบประมาณ (อนุมัติ)<span style="color:red !important;">*</span>:</label>
                <input type="text" class="form-control bg-white col-sm-4 amount" id="projectBudgetApprove" name="projectBudgetApprove"
                       th:attr="value=${project.projectBudgetApprove != null}? ${project.projectBudgetApprove}: ''" onblur="amtFormat()" required/>
            </div>

            <div  class="row mb-2">
                <label class="col-sm-2 form-control-label" for="projectPersonTarget">จำนวนผู้เข้าร่วมกิจกรรม (เป้า)<span style="color:red !important;">*</span>:</label>
                <input type="text" class="form-control bg-white col-sm-4" id="projectPersonTarget" name="projectPersonTarget"
                       th:attr="value=${project.projectPersonTarget != null}? ${project.projectPersonTarget}: ''" required/>
                <label class="col-sm-2 form-control-label" for="projectPersonActual">จำนวนผู้เข้าร่วมกิจกรรม (เข้าร่วมจริง)<span style="color:red !important;">*</span>:</label>
                <input type="text" class="form-control bg-white col-sm-4" id="projectPersonActual" name="projectPersonActual"
                       th:attr="value=${project.projectPersonActual != null}? ${project.projectPersonActual}: ''" required/>
            </div>

            <div  class="row mb-2">
                <label class="col-sm-2 form-control-label" for="projectPreDateFrom">ระยะเวลาเตรียมกิจกรรม<span style="color:red !important;">*</span>:</label>
                <input type="date" class="form-control bg-white col-sm-3" id="projectPreDateFrom" name="projectPreDateFrom"
                       th:attr="value=${project.projectPreDateFrom != null}? ${project.projectPreDateFrom}: ''" required/>
                <label class="ml-3 form-control-label" for="projectPersonActual">ถึง<span style="color:red !important;">*</span>:</label>
                <input type="date" class="form-control bg-white col-sm-3" id="projectPreDateTo" name="projectPreDateTo"
                       th:attr="value=${project.projectPreDateTo != null}? ${project.projectPreDateTo}: ''" required/>
            </div>

            <div  class="row mb-2">
                <label class="col-sm-2 form-control-label" for="projectDateFrom">วันที่จัดกิจกรรม<span style="color:red !important;">*</span>:</label>
                <input type="date" class="form-control bg-white col-sm-3" id="projectDateFrom" name="projectDateFrom"
                       th:attr="value=${project.projectDateFrom != null}? ${project.projectDateFrom}: ''" required/>
                <label class="ml-3 form-control-label" for="projectDateTo">ถึง<span style="color:red !important;">*</span>:</label>
                <input type="date" class="form-control bg-white col-sm-3" id="projectDateTo" name="projectDateTo"
                       th:attr="value=${project.projectDateTo != null}? ${project.projectDateTo}: ''" required/>
            </div>

            <div  class="row mb-2">
                <label class="col-sm-2 form-control-label" for="projectLocation">สถานที่จัดโครงการ<span style="color:red !important;">*</span>:</label>
                <input type="text" class="form-control bg-white col-sm-4" id="projectLocation" name="projectLocation"
                       th:attr="value=${project.projectLocation != null}? ${project.projectLocation}: ''" required/>
                <label class="col-sm-2 form-control-label" for="projectKind">ลักษณะกิจกรรม/โครงการ<span style="color:red !important;">*</span>:</label>
                <input type="text" class="form-control bg-white col-sm-4" id="projectKind" name="projectKind"
                       th:attr="value=${project.projectKind != null}? ${project.projectKind}: ''" required/>
            </div>

            <div id="searchParticipant" class="row mt-4 mb-2 ml-1">
                <button type="button" class="btn btn-poba btn-add mr-3" data-toggle="modal" data-target="#participantModal">เพิ่มผู้เข้าร่วม</button>
            </div>

            <div class="table table-responsive">
                <table id="table-participant" class="display" width="100%">
                    <thead>
                    <tr>
                        <th>#</th>
                        <th>เลขประจำตัว</th>
                        <th>ชื่อ-นามสกุล</th>
                        <th>สถานะเข้าร่วมกิจกรรม</th>
                    </tr>
                    </thead>
                    <tbody>
                        <tr th:each="participant, itemStat : ${project.participants}">
                            <td>
                                <input hidden th:name="|participants[${itemStat.index}].id|" th:value="${participant.getId()}"/>
                                <input type="checkbox"/>
                            </td>
                            <td>
                                <input th:name="|participants[${itemStat.index}].participantId|" th:value="${participant.getParticipantId()}" style="border: none;" readonly/>
                            </td>
                            <td>
                                <input th:name="|participants[${itemStat.index}].name|" th:value="${participant.getName()}" style="border: none;"  readonly/>
                            </td>
                            <td>
                                <select th:name="|participants[${itemStat.index}].status|">
                                    <option value="">กรุณาเลือก</option>
                                    <option value="ที่ปรึกษาโครงการ" th:selected="${participant.getStatus() == 'ที่ปรึกษาโครงการ'}? 'selected'">ที่ปรึกษาโครงการ</option>
                                    <option value="ที่ปรึกษา/เข้าร่วมโครงการ" th:selected="${participant.getStatus() == 'ที่ปรึกษา/เข้าร่วมโครงการ'}? 'selected'">ที่ปรึกษา/เข้าร่วมโครงการ</option>
                                    <option value="ผู้รับผิดชอบโครงการ" th:selected="${participant.getStatus() == 'ผู้รับผิดชอบโครงการ'}? 'selected'">ผู้รับผิดชอบโครงการ</option>
                                    <option value="ผู้ปฏิบัติงาน" th:selected="${participant.getStatus() == 'ผู้ปฏิบัติงาน'}? 'selected'">ผู้ปฏิบัติงาน</option>
                                    <option value="เข้าร่วมโครงการ" th:selected="${participant.getStatus() == 'เข้าร่วมโครงการ'}? 'selected'">เข้าร่วมโครงการ</option>
                                    <option value="สัมภาษณ์ทุน" th:selected="${participant.getStatus() == 'สัมภาษณ์ทุน'}? 'selected'">สัมภาษณ์ทุน</option>
                                </select>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <button type="button" class="btn btn-outline-poba btn-del" onclick="removeParticipant()">ลบผู้เข้าร่วม</button>

        </form>
        <!-- Modal -->
        <div class="modal fade" id="participantModal" tabindex="-1" role="dialog" aria-labelledby="participantModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalLabel">เพิ่มผู้เข้าร่วมกิจกรรม</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="row px-3 mb-xl-0 mb-3 flex-xl-fill">
                            <input id="searchTxt" type="text" class="col-8 mr-2 form-control flex-xl-grow-1" placeholder="ค้นหาด้วยเลขประจำตัว/ชื่อ">
                            <button type="button" class="btn btn-info" onclick="findParticipant()">ค้นหา</button>
                        </div>
                    </div>
                    <div class="table table-responsive">
                        <table id="table-participant-modal" class="display" width="100%">
                            <thead>
                            <tr>
                                <th>#</th>
                                <th>เลขประจำตัว</th>
                                <th>ชื่อ-นามสกุล</th>
                                <th>สถานะเข้าร่วมกิจกรรม</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td colspan="4" class="dataTables_empty text-center bg-secondary">ผู้เข้าร่วมกิจกรรม</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-poba" data-dismiss="modal">ยกเลิก</button>
                        <button type="button" class="btn btn-poba" data-dismiss="modal" onclick="addParticipant()">เพิ่ม</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="submit" class="row mt-5 mb-5 text-align-center" th:classappend="${viewName != 'ดูข้อมูล' ? 'd-block' : 'd-none'} ">
            <button type="button" class="btn btn-poba mr-3" onclick="submitProjectInfo();">บันทึก</button>
            <a href="javascript:void(0)" onclick="loadView('/poba/project')" class="btn btn-outline-poba mr-3">ยกเลิก</a>
        </div>
        <div id="edit"class="row mt-5 mb-5 text-align-center" th:classappend="${viewName == 'ดูข้อมูล' ? 'd-block' : 'd-none'}">
            <a href="javascript:void(0)" onclick="loadView('/poba/project')" class="btn btn-poba mr-3">ยกเลิก</a>
            <button type="button" class="btn btn-outline-poba mr-3" onclick="editProjectInfo();">แก้ไข</button>
        </div>
    </div>

    <script>
        $(document).ready(function() {
             var viewName = $("#viewName").text();
             if(viewName == "ดูข้อมูล"){
                $("input").prop("disabled", true);
                $("select").prop("disabled", true);
                $(".btn-add").prop("disabled", true);
                $(".btn-del").prop("disabled", true);
             }
             amtFormat();
        });

    </script>

</th:block>
</html>